(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{172:function(e,t,a){Promise.resolve().then(a.bind(a,9485))},9485:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var r=a(7437),s=a(9974),i=a.n(s),l=a(2265),n=a(9064),o=a(4569),c=a(3639),d=a(2735),h=a(7689);function y(){let[e,t]=(0,l.useState)(!1),[a,s]=(0,l.useState)(!1),[i,n]=(0,l.useState)(null);(0,l.useEffect)(()=>{y()},[]);let y=async()=>{try{let e=await o.U0.getLeaves(),a=await o.U0.getSettings(),r=e.length>0||null!==a;s(r);let i=localStorage.getItem("leave-tracker-backup-date");n(i),r&&i||t(!0)}catch(e){console.error("Error checking data status:",e),t(!0)}},u=async()=>{try{let e=await o.U0.exportData(),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="leave-tracker-backup-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),localStorage.setItem("leave-tracker-backup-date",new Date().toISOString()),n(new Date().toISOString())}catch(e){console.error("Export failed:",e)}};return e?(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 max-w-md bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg shadow-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-200 mb-2",children:"\uD83D\uDCF1 Application D\xe9ploy\xe9e"}),(0,r.jsxs)("div",{className:"text-xs text-yellow-700 dark:text-yellow-300 space-y-2",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Important :"})," Cette application utilise le stockage local de votre navigateur."]}),(0,r.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 p-2 rounded",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"⚠️ Vos donn\xe9es sont stock\xe9es localement :"}),(0,r.jsxs)("ul",{className:"text-xs space-y-1",children:[(0,r.jsx)("li",{children:"• Pas de synchronisation entre appareils"}),(0,r.jsx)("li",{children:"• Perte possible si vous effacez les donn\xe9es du navigateur"}),(0,r.jsx)("li",{children:"• Exportez r\xe9guli\xe8rement vos donn\xe9es"})]})]}),!a&&(0,r.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-2 rounded",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"\uD83D\uDCE5 Premi\xe8re utilisation :"}),(0,r.jsx)("p",{className:"text-xs",children:"Importez vos donn\xe9es existantes si vous en avez."})]}),i&&(0,r.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/30 p-2 rounded",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"✅ Derni\xe8re sauvegarde :"}),(0,r.jsx)("p",{className:"text-xs",children:new Date(i).toLocaleDateString("fr-FR")})]})]}),(0,r.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,r.jsxs)("button",{onClick:u,className:"flex items-center px-2 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs rounded transition-colors",children:[(0,r.jsx)(d.Z,{className:"w-3 h-3 mr-1"}),"Exporter"]}),(0,r.jsxs)("label",{className:"flex items-center px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors cursor-pointer",children:[(0,r.jsx)(h.Z,{className:"w-3 h-3 mr-1"}),"Importer",(0,r.jsx)("input",{type:"file",accept:".json",onChange:e=>{var a;let r=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!r)return;let i=new FileReader;i.onload=async e=>{try{var a;let r=null===(a=e.target)||void 0===a?void 0:a.result;await o.U0.importData(r),s(!0),t(!1),window.location.reload()}catch(e){console.error("Import failed:",e)}},i.readAsText(r)},className:"hidden"})]}),(0,r.jsx)("button",{onClick:()=>t(!1),className:"px-2 py-1 bg-gray-600 hover:bg-gray-700 text-white text-xs rounded transition-colors",children:"Fermer"})]})]})]})}):null}function u(e){let{children:t}=e,[a,s]=(0,l.useState)(null),[c,d]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{(async()=>{try{let e=await o.U0.getSettings();if(e)s(e);else{let e={firstDayOfWeek:"monday",country:"FR",publicHolidays:[],quotas:[{type:"cp",yearlyQuota:25},{type:"rtt",yearlyQuota:10},{type:"sick",yearlyQuota:0}],darkMode:!1,notifications:!0};s(e),await o.U0.saveSettings(e)}}catch(e){console.error("Erreur lors du chargement des param\xe8tres:",e),s({firstDayOfWeek:"monday",country:"FR",publicHolidays:[],quotas:[{type:"cp",yearlyQuota:25},{type:"rtt",yearlyQuota:10},{type:"sick",yearlyQuota:0}],darkMode:!1,notifications:!0})}finally{d(!1)}})()},[]),(0,l.useEffect)(()=>{(null==a?void 0:a.darkMode)?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[null==a?void 0:a.darkMode]),c)?(0,r.jsx)("html",{lang:"fr",children:(0,r.jsx)("body",{className:"".concat(i().className," bg-gray-50 dark:bg-gray-900"),children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-500"})})})}):(0,r.jsxs)("html",{lang:"fr",className:(null==a?void 0:a.darkMode)?"dark":"",children:[(0,r.jsxs)("head",{children:[(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"}),(0,r.jsx)("meta",{name:"theme-color",content:(null==a?void 0:a.darkMode)?"#1f2937":"#ffffff"}),(0,r.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,r.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:(null==a?void 0:a.darkMode)?"black-translucent":"default"}),(0,r.jsx)("meta",{name:"format-detection",content:"telephone=no"}),(0,r.jsx)("meta",{name:"mobile-web-app-capable",content:"yes"})]}),(0,r.jsxs)("body",{className:"".concat(i().className," bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200"),children:[(0,r.jsx)("div",{className:"min-h-screen",children:t}),(0,r.jsx)(y,{}),(0,r.jsx)(n.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:(null==a?void 0:a.darkMode)?"#374151":"#ffffff",color:(null==a?void 0:a.darkMode)?"#f9fafb":"#111827",border:"1px solid ".concat((null==a?void 0:a.darkMode)?"#4b5563":"#e5e7eb")},success:{iconTheme:{primary:"#22c55e",secondary:"#ffffff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#ffffff"}}}})]})]})}a(2778)},4569:function(e,t,a){"use strict";a.d(t,{U0:function(){return i}});var r=a(960);class s{async init(){this.db||(this.db=await (0,r.X3)(this.DB_NAME,this.DB_VERSION,{upgrade(e){let t=e.createObjectStore("leaves",{keyPath:"id"});t.createIndex("by-date","startDate"),t.createIndex("by-type","type"),e.createObjectStore("settings",{keyPath:"id"}),e.createObjectStore("balances",{keyPath:"id"}),e.createObjectStore("holidays",{keyPath:"id"});let a=e.createObjectStore("carryover",{keyPath:"id"});a.createIndex("by-type","type"),a.createIndex("by-year","year")}}))}async getLeaves(){return await this.init(),this.db.getAll("leaves")}async getLeave(e){return await this.init(),this.db.get("leaves",e)}async addLeave(e){await this.init(),await this.db.add("leaves",e)}async updateLeave(e){await this.init(),await this.db.put("leaves",e)}async deleteLeave(e){await this.init(),await this.db.delete("leaves",e)}async saveLeaves(e){for(let t of(await this.init(),await this.db.clear("leaves"),e))await this.db.add("leaves",t)}async clearLeaves(){await this.init(),await this.db.clear("leaves")}async getLeavesByYear(e){return await this.init(),(await this.getLeaves()).filter(t=>new Date(t.startDate).getFullYear()===e)}async getLeavesByType(e){return await this.init(),this.db.getAllFromIndex("leaves","by-type",e)}async getSettings(){return await this.init(),this.db.get("settings","app-settings")}async saveSettings(e){await this.init(),await this.db.put("settings",{id:"app-settings",...e})}async getBalances(){return await this.init(),await this.db.get("balances","current-balances")||[]}async saveBalances(e){await this.init(),await this.db.put("balances",{id:"current-balances",balances:e})}async getHolidays(){return await this.init(),await this.db.get("holidays","french-holidays")||[]}async saveHolidays(e){await this.init(),await this.db.put("holidays",{id:"french-holidays",holidays:e})}async getCarryoverLeaves(){try{return await this.init(),this.db.getAll("carryover")}catch(e){return console.log("Store carryover non trouv\xe9, retour d'un tableau vide:",e),[]}}async getCarryoverLeave(e){return await this.init(),this.db.get("carryover",e)}async addCarryoverLeave(e){await this.init(),await this.db.add("carryover",e)}async updateCarryoverLeave(e){await this.init(),await this.db.put("carryover",e)}async deleteCarryoverLeave(e){await this.init(),await this.db.delete("carryover",e)}async saveCarryoverLeaves(e){for(let t of(await this.init(),await this.db.clear("carryover"),e))await this.db.add("carryover",t)}async clearCarryoverLeaves(){await this.init(),await this.db.clear("carryover")}async getCarryoverLeavesByType(e){return await this.init(),this.db.getAllFromIndex("carryover","by-type",e)}async getCarryoverLeavesByYear(e){return await this.init(),this.db.getAllFromIndex("carryover","by-year",e)}async exportData(){let e=await this.getLeaves(),t=await this.getSettings(),a=await this.getBalances(),r=await this.getHolidays(),s=[];try{s=await this.getCarryoverLeaves()}catch(e){console.log("Carryover store non trouv\xe9 lors de l'export:",e),s=[]}return JSON.stringify({leaves:e,settings:t,balances:a,holidays:r,carryovers:s,exportDate:new Date().toISOString(),version:"1.0.0"},null,2)}async exportDataWithUserChoice(){try{let e=await this.exportData(),t="leave-tracker-backup-".concat(new Date().toISOString().split("T")[0],".json");if(navigator.share&&navigator.canShare){let a=new Blob([e],{type:"application/json"}),r=new File([a],t,{type:"application/json"});if(navigator.canShare({files:[r]})){await navigator.share({files:[r],title:"Leave Tracker Backup",text:"Sauvegarde Leave Tracker du ".concat(new Date().toLocaleDateString("fr-FR"))});return}}this.downloadFile(e,t)}catch(a){console.error("Erreur lors de l'export:",a);let e=await this.exportData(),t="leave-tracker-backup-".concat(new Date().toISOString().split("T")[0],".json");this.downloadFile(e,t)}}downloadFile(e,t){let a=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}async importData(e){try{let t=JSON.parse(e);if(!t.leaves||!Array.isArray(t.leaves))throw Error("Format de donn\xe9es invalide");for(let e of(await this.init(),await this.db.clear("leaves"),await this.db.clear("settings"),await this.db.clear("balances"),await this.db.clear("holidays"),await this.db.clear("carryover"),t.leaves))await this.addLeave(e);t.settings&&await this.saveSettings(t.settings),t.balances&&await this.saveBalances(t.balances),t.holidays&&await this.saveHolidays(t.holidays),t.carryovers&&await this.saveCarryoverLeaves(t.carryovers)}catch(e){throw console.error("Erreur lors de l'import:",e),Error("Erreur lors de l'import des donn\xe9es")}}async importDataWithFileSelection(){return new Promise((e,t)=>{let a=document.createElement("input");a.type="file",a.accept=".json",a.style.display="none",a.onchange=async r=>{var s;let i=null===(s=r.target.files)||void 0===s?void 0:s[0];if(!i){t(Error("Aucun fichier s\xe9lectionn\xe9"));return}try{let t=await i.text();await this.importData(t),e()}catch(e){t(e)}finally{document.body.removeChild(a)}},a.oncancel=()=>{t(Error("Import annul\xe9")),document.body.removeChild(a)},document.body.appendChild(a),a.click()})}async backupToLocalStorage(){try{let e=await this.exportData();localStorage.setItem("leave-tracker-backup",e),localStorage.setItem("leave-tracker-backup-date",new Date().toISOString());let t=new Date().toISOString().split("T")[0];localStorage.setItem("leave-tracker-backup-".concat(t),e),this.cleanupOldBackups()}catch(e){console.error("Erreur lors de la sauvegarde:",e)}}async restoreFromLocalStorage(){try{let e=localStorage.getItem("leave-tracker-backup");if(e)return await this.importData(e),!0;let t=Object.keys(localStorage).filter(e=>e.startsWith("leave-tracker-backup-")).sort().reverse();if(t.length>0){let e=localStorage.getItem(t[0]);if(e)return await this.importData(e),!0}return!1}catch(e){return console.error("Erreur lors de la restauration:",e),!1}}cleanupOldBackups(){try{let e=Object.keys(localStorage).filter(e=>e.startsWith("leave-tracker-backup-")).sort().reverse();e.length>5&&e.slice(5).forEach(e=>{localStorage.removeItem(e)})}catch(e){console.error("Erreur lors du nettoyage des sauvegardes:",e)}}async getAvailableBackups(){try{let e=[],t=localStorage.getItem("leave-tracker-backup");if(t){let a=localStorage.getItem("leave-tracker-backup-date");e.push({date:a||"Unknown",size:t.length})}return Object.keys(localStorage).filter(e=>e.startsWith("leave-tracker-backup-")).sort().reverse().forEach(t=>{let a=localStorage.getItem(t);if(a){let r=t.replace("leave-tracker-backup-","");e.push({date:r,size:a.length})}}),e}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration des sauvegardes:",e),[]}}async clearAllData(){await this.init(),await this.db.clear("leaves"),await this.db.clear("settings"),await this.db.clear("balances"),await this.db.clear("holidays"),await this.db.clear("carryover")}async getDatabaseStats(){await this.init();let e=await this.getLeaves(),t=localStorage.getItem("leave-tracker-backup-date");return{totalLeaves:e.length,totalSize:new Blob([JSON.stringify(e)]).size,lastBackup:t||void 0}}constructor(){this.db=null,this.DB_NAME="LeaveTrackerDB",this.DB_VERSION=1}}let i=new s},2778:function(){}},function(e){e.O(0,[635,216,744],function(){return e(e.s=172)}),_N_E=e.O()}]);