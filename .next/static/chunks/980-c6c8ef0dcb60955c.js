"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[980],{9031:function(e,t,a){a.d(t,{Io:function(){return v},N4:function(){return b},P1:function(){return p},XW:function(){return f},Y:function(){return k},d:function(){return u},dl:function(){return h},hJ:function(){return y},p6:function(){return w},sj:function(){return g},uk:function(){return m}});var r=a(6662),i=a(219),n=a(8700),s=a(6496),o=a(6900),l=a(3004);let c=[{id:"1",date:"2024-01-01",name:"Jour de l'an",country:"FR"},{id:"2",date:"2024-05-01",name:"F\xeate du travail",country:"FR"},{id:"3",date:"2024-05-08",name:"Victoire 1945",country:"FR"},{id:"4",date:"2024-05-09",name:"Ascension",country:"FR"},{id:"5",date:"2024-05-20",name:"Lundi de Pentec\xf4te",country:"FR"},{id:"6",date:"2024-07-14",name:"F\xeate nationale",country:"FR"},{id:"7",date:"2024-08-15",name:"Assomption",country:"FR"},{id:"8",date:"2024-11-01",name:"Toussaint",country:"FR"},{id:"9",date:"2024-11-11",name:"Armistice",country:"FR"},{id:"10",date:"2024-12-25",name:"No\xebl",country:"FR"}],d=[{id:"1",date:"2025-01-01",name:"Jour de l'an",country:"FR"},{id:"2",date:"2025-05-01",name:"F\xeate du travail",country:"FR"},{id:"3",date:"2025-05-08",name:"Victoire 1945",country:"FR"},{id:"4",date:"2025-05-29",name:"Ascension",country:"FR"},{id:"5",date:"2025-06-09",name:"Lundi de Pentec\xf4te",country:"FR"},{id:"6",date:"2025-07-14",name:"F\xeate nationale",country:"FR"},{id:"7",date:"2025-08-15",name:"Assomption",country:"FR"},{id:"8",date:"2025-11-01",name:"Toussaint",country:"FR"},{id:"9",date:"2025-11-11",name:"Armistice",country:"FR"},{id:"10",date:"2025-12-25",name:"No\xebl",country:"FR"}];function u(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];arguments.length>4&&arguments[4];let l=new Date(e),c=new Date(t);if(isNaN(l.getTime())||isNaN(c.getTime()))return console.error("Invalid date input:",{startDate:e,endDate:t}),0;let d=0,u=l;for(;!(0,r.A)(u,c);)!(0,i.Q)(u)&&!function(e,t){return t.some(t=>{let a=new Date(t.date);return e.toISOString().split("T")[0]===a.toISOString().split("T")[0]})}(u,a)&&d++,u=(0,n.E)(u,1);return o&&d>0&&(0,s.K)(l,c)&&(d=.5),d}function y(e){return 2024===e?c:2025===e?d:[]}function h(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date().getFullYear(),i=[];return t.forEach(t=>{let n=e.filter(e=>e.type===t.type&&new Date(e.startDate).getFullYear()===r).reduce((e,t)=>e+t.workingDays,0),s=a.filter(e=>e.type===t.type).reduce((e,t)=>e+t.days,0),o=t.yearlyQuota+s;i.push({type:t.type,total:o,used:n,remaining:Math.max(0,o-n),carryover:s})}),i}function v(e){let t={},a={cp:[],rtt:[],cet:[],sick:[]},r={cp:0,rtt:0,cet:0,sick:0};return e.forEach(e=>{t[e.year]||(t[e.year]=[]),t[e.year].push(e),a[e.type].push(e),r[e.type]+=e.days}),{byYear:t,byType:a,totalByType:r}}function g(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,r=[],i=0,n=new Date(e);for(;n<=t;){let e=n.getMonth()+1,t=n.getFullYear(),s=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,r=a.getMonth()+1,i=a.getFullYear();return t>i?{canTake:!1,reason:"Les RTT de ".concat(t," ne sont pas encore disponibles"),availableDays:0}:t<i?{canTake:!0,availableDays:2}:e<r?{canTake:!0,availableDays:2}:e===r?{canTake:!0,availableDays:2}:{canTake:!0,availableDays:2,reason:"RTT disponible en pr\xe9vision pour ".concat(t)}}(e,t,a);r.push({month:e,year:t,available:s.availableDays,canTake:s.canTake}),i+=s.availableDays,n.setMonth(n.getMonth()+1)}return{totalAvailable:i,details:r}}function p(e,t){var a,r,i,n,s,o;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date().getFullYear(),d=[],u=["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"],y=new Date,h=y.getMonth()+1,v=y.getFullYear(),g=(null===(a=t.find(e=>"rtt"===e.type))||void 0===a?void 0:a.yearlyQuota)||23,p=((null===(r=t.find(e=>"cp"===e.type))||void 0===r?void 0:r.yearlyQuota)||25)+((null===(i=t.find(e=>"cet"===e.type))||void 0===i?void 0:i.yearlyQuota)||5),w=(null===(n=l.find(e=>"rtt"===e.type))||void 0===n?void 0:n.days)||0,b=((null===(s=l.find(e=>"cp"===e.type))||void 0===s?void 0:s.days)||0)+((null===(o=l.find(e=>"cet"===e.type))||void 0===o?void 0:o.days)||0);d.push({month:0,monthName:"Reliquats",rtt:{real:{taken:0,cumul:0,remaining:w},forecast:{taken:0,cumul:0,remaining:w}},cp:{real:{taken:0,cumul:0,remaining:b},forecast:{taken:0,cumul:0,remaining:b}}});let f=0,m=0,k=0,D=0;for(let t=1;t<=12;t++){let a=e.filter(e=>{let a=new Date(e.startDate);return a.getFullYear()===c&&a.getMonth()===t-1}),r=c<v||c===v&&t<h,i=c===v&&t===h,n=a.filter(e=>"rtt"===e.type&&(!e.isForecast||r)).reduce((e,t)=>e+t.workingDays,0),s=a.filter(e=>"cp"===e.type&&(!e.isForecast||r)).reduce((e,t)=>e+t.workingDays,0),o=a.filter(e=>"rtt"===e.type&&(e.isForecast||!r&&!i)).reduce((e,t)=>e+t.workingDays,0),l=a.filter(e=>"cp"===e.type&&(e.isForecast||!r&&!i)).reduce((e,t)=>e+t.workingDays,0),y=Math.max(0,g+w-(f+=n)),S=Math.max(0,g+w-f-(m+=o)),F=Math.max(0,p+b-(k+=s)),L=Math.max(0,p+b-k-(D+=l));d.push({month:t,monthName:u[t-1],rtt:{real:{taken:n,cumul:f,remaining:y},forecast:{taken:o,cumul:m,remaining:S}},cp:{real:{taken:s,cumul:k,remaining:F},forecast:{taken:l,cumul:D,remaining:L}}})}return{months:d,yearlyTotals:{rtt:{real:f,forecast:m,total:f+m},cp:{real:k,forecast:D,total:k+D}}}}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dd/MM/yyyy",a="string"==typeof e?new Date(e):e;return isNaN(a.getTime())?(console.error("Invalid date for formatting:",e),"Date invalide"):(0,o.WU)(a,t,{locale:l.fr})}function b(e,t){let a=e.filter(e=>new Date(e.startDate).getFullYear()===t),r=a.reduce((e,t)=>e+t.workingDays,0),i={cp:0,rtt:0,cet:0,sick:0},n={};return a.forEach(e=>{i[e.type]+=e.workingDays;let t=new Date(e.startDate),a=(0,o.WU)(t,"yyyy-MM");n[a]=(n[a]||0)+e.workingDays}),{totalDays:r,byType:i,byMonth:n}}function f(e){if(!e||10!==e.length)return"";let t=e.split("/");if(3!==t.length)return"";let[a,r,i]=t;return"".concat(i,"-").concat(r.padStart(2,"0"),"-").concat(a.padStart(2,"0"))}function m(e){if(!e||10!==e.length)return"";let t=e.split("-");if(3!==t.length)return"";let[a,r,i]=t;return"".concat(i,"/").concat(r,"/").concat(a)}function k(e){if(!e||10!==e.length)return!1;let t=e.split("/");if(3!==t.length)return!1;let[a,r,i]=t,n=new Date("".concat(i,"-").concat(r.padStart(2,"0"),"-").concat(a.padStart(2,"0")));return!isNaN(n.getTime())&&n.getFullYear()>=2020&&2030>=n.getFullYear()}},4569:function(e,t,a){a.d(t,{U0:function(){return n}});var r=a(960);class i{async init(){this.db||(this.db=await (0,r.X3)(this.DB_NAME,this.DB_VERSION,{upgrade(e){let t=e.createObjectStore("leaves",{keyPath:"id"});t.createIndex("by-date","startDate"),t.createIndex("by-type","type"),e.createObjectStore("settings",{keyPath:"id"}),e.createObjectStore("balances",{keyPath:"id"}),e.createObjectStore("holidays",{keyPath:"id"});let a=e.createObjectStore("carryover",{keyPath:"id"});a.createIndex("by-type","type"),a.createIndex("by-year","year")}}))}async getLeaves(){return await this.init(),this.db.getAll("leaves")}async getLeave(e){return await this.init(),this.db.get("leaves",e)}async addLeave(e){await this.init(),await this.db.add("leaves",e)}async updateLeave(e){await this.init(),await this.db.put("leaves",e)}async deleteLeave(e){await this.init(),await this.db.delete("leaves",e)}async saveLeaves(e){for(let t of(await this.init(),await this.db.clear("leaves"),e))await this.db.add("leaves",t)}async clearLeaves(){await this.init(),await this.db.clear("leaves")}async getLeavesByYear(e){return await this.init(),(await this.getLeaves()).filter(t=>new Date(t.startDate).getFullYear()===e)}async getLeavesByType(e){return await this.init(),this.db.getAllFromIndex("leaves","by-type",e)}async getSettings(){return await this.init(),this.db.get("settings","app-settings")}async saveSettings(e){await this.init(),await this.db.put("settings",{id:"app-settings",...e})}async getBalances(){return await this.init(),await this.db.get("balances","current-balances")||[]}async saveBalances(e){await this.init(),await this.db.put("balances",{id:"current-balances",balances:e})}async getHolidays(){return await this.init(),await this.db.get("holidays","french-holidays")||[]}async saveHolidays(e){await this.init(),await this.db.put("holidays",{id:"french-holidays",holidays:e})}async getCarryoverLeaves(){try{return await this.init(),this.db.getAll("carryover")}catch(e){return console.log("Store carryover non trouv\xe9, retour d'un tableau vide:",e),[]}}async getCarryoverLeave(e){return await this.init(),this.db.get("carryover",e)}async addCarryoverLeave(e){await this.init(),await this.db.add("carryover",e)}async updateCarryoverLeave(e){await this.init(),await this.db.put("carryover",e)}async deleteCarryoverLeave(e){await this.init(),await this.db.delete("carryover",e)}async saveCarryoverLeaves(e){for(let t of(await this.init(),await this.db.clear("carryover"),e))await this.db.add("carryover",t)}async clearCarryoverLeaves(){await this.init(),await this.db.clear("carryover")}async getCarryoverLeavesByType(e){return await this.init(),this.db.getAllFromIndex("carryover","by-type",e)}async getCarryoverLeavesByYear(e){return await this.init(),this.db.getAllFromIndex("carryover","by-year",e)}async exportData(){let e=await this.getLeaves(),t=await this.getSettings(),a=await this.getBalances(),r=await this.getHolidays(),i=[];try{i=await this.getCarryoverLeaves()}catch(e){console.log("Carryover store non trouv\xe9 lors de l'export:",e),i=[]}return JSON.stringify({leaves:e,settings:t,balances:a,holidays:r,carryovers:i,exportDate:new Date().toISOString(),version:"1.0.0"},null,2)}async exportDataWithUserChoice(){try{let e=await this.exportData(),t="leave-tracker-backup-".concat(new Date().toISOString().split("T")[0],".json");if(navigator.share&&navigator.canShare){let a=new Blob([e],{type:"application/json"}),r=new File([a],t,{type:"application/json"});if(navigator.canShare({files:[r]})){await navigator.share({files:[r],title:"Leave Tracker Backup",text:"Sauvegarde Leave Tracker du ".concat(new Date().toLocaleDateString("fr-FR"))});return}}this.downloadFile(e,t)}catch(a){console.error("Erreur lors de l'export:",a);let e=await this.exportData(),t="leave-tracker-backup-".concat(new Date().toISOString().split("T")[0],".json");this.downloadFile(e,t)}}downloadFile(e,t){let a=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}async importData(e){try{let t=JSON.parse(e);if(!t.leaves||!Array.isArray(t.leaves))throw Error("Format de donn\xe9es invalide");for(let e of(await this.init(),await this.db.clear("leaves"),await this.db.clear("settings"),await this.db.clear("balances"),await this.db.clear("holidays"),await this.db.clear("carryover"),t.leaves))await this.addLeave(e);t.settings&&await this.saveSettings(t.settings),t.balances&&await this.saveBalances(t.balances),t.holidays&&await this.saveHolidays(t.holidays),t.carryovers&&await this.saveCarryoverLeaves(t.carryovers)}catch(e){throw console.error("Erreur lors de l'import:",e),Error("Erreur lors de l'import des donn\xe9es")}}async importDataWithFileSelection(){return new Promise((e,t)=>{let a=document.createElement("input");a.type="file",a.accept=".json",a.style.display="none",a.onchange=async r=>{var i;let n=null===(i=r.target.files)||void 0===i?void 0:i[0];if(!n){t(Error("Aucun fichier s\xe9lectionn\xe9"));return}try{let t=await n.text();await this.importData(t),e()}catch(e){t(e)}finally{document.body.removeChild(a)}},a.oncancel=()=>{t(Error("Import annul\xe9")),document.body.removeChild(a)},document.body.appendChild(a),a.click()})}async backupToLocalStorage(){try{let e=await this.exportData();localStorage.setItem("leave-tracker-backup",e),localStorage.setItem("leave-tracker-backup-date",new Date().toISOString());let t=new Date().toISOString().split("T")[0];localStorage.setItem("leave-tracker-backup-".concat(t),e),this.cleanupOldBackups()}catch(e){console.error("Erreur lors de la sauvegarde:",e)}}async restoreFromLocalStorage(){try{let e=localStorage.getItem("leave-tracker-backup");if(e)return await this.importData(e),!0;let t=Object.keys(localStorage).filter(e=>e.startsWith("leave-tracker-backup-")).sort().reverse();if(t.length>0){let e=localStorage.getItem(t[0]);if(e)return await this.importData(e),!0}return!1}catch(e){return console.error("Erreur lors de la restauration:",e),!1}}cleanupOldBackups(){try{let e=Object.keys(localStorage).filter(e=>e.startsWith("leave-tracker-backup-")).sort().reverse();e.length>5&&e.slice(5).forEach(e=>{localStorage.removeItem(e)})}catch(e){console.error("Erreur lors du nettoyage des sauvegardes:",e)}}async getAvailableBackups(){try{let e=[],t=localStorage.getItem("leave-tracker-backup");if(t){let a=localStorage.getItem("leave-tracker-backup-date");e.push({date:a||"Unknown",size:t.length})}return Object.keys(localStorage).filter(e=>e.startsWith("leave-tracker-backup-")).sort().reverse().forEach(t=>{let a=localStorage.getItem(t);if(a){let r=t.replace("leave-tracker-backup-","");e.push({date:r,size:a.length})}}),e}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration des sauvegardes:",e),[]}}async clearAllData(){await this.init(),await this.db.clear("leaves"),await this.db.clear("settings"),await this.db.clear("balances"),await this.db.clear("holidays"),await this.db.clear("carryover")}async getDatabaseStats(){await this.init();let e=await this.getLeaves(),t=localStorage.getItem("leave-tracker-backup-date");return{totalLeaves:e.length,totalSize:new Blob([JSON.stringify(e)]).size,lastBackup:t||void 0}}constructor(){this.db=null,this.DB_NAME="LeaveTrackerDB",this.DB_VERSION=1}}let n=new i}}]);